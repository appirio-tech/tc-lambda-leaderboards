language: node_js
node_js:
- "0.10.36"
install:
- npm install
before_script:
  - chmod +x deploy.sh
script:
  - npm test
sudo: false
deploy:
- provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    branch: dev
- provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    branch: release
- provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    branch: master

env:
  matrix:
    - CXX=g++-4.8
  global:
    # DEV_MEMBER_ES_HOST
    - secure: yva/mmqct4jduOkIcYXTow1qV58W0NOqk/p+kSMEA/JoloeA1qxq/cdxSZzdTzpCe0pSDdOqI4pjiYd+P9FGl9BkhYYxWvbPb1WJgrgT+T1SL2J+PAbWO7VeE6dJp9spBU3QdXo5h4EPpeou7P+vjYD8QC6sh1rNtO4KIjJctoN6VtYQN1IzbJ8T0seJwWD8AX48KGpdS5c9nd+8dtId0qBplAD2mFdZr9ip7UGGoJpVDJ/L6Th75lbFlJ9Cp8TLgfgI+J54gxXkXg+ljL0b60ECmNJ5HFMnBnMgIP6Vy8P3uUmo8ezKXd0WJWxivfiynm1t4mgz2b+/prOl2Hgz/DoQxtFokj8zRiF4h7DQRysbntXpQMvJ5By3aGluUj/bhChKGCZqoD5iPBiiR6KFwsTbAsBGSgtVG+OKSgQdkyKbWz94H+IeLhrX1NOGkFlN0hQ82xYAVPIViQOdPtD+t3znmViZ4owfYBKeMfSVTIDrNSWw8kthZ5MNl/BsvT76Bg5qkNR+gEtfOp+N5lovBeSEmLk/iuSxHNFUmNSF8G3Kf3ZaFMEGt493DFKDvFi68IBXDUPbEIw6i5bdBR/t7LEw5htQD8hpMoxM1TRdLutTXgunUTZR06mpaB0zinAzJxrYAJSG89MuF8ORUg1LmGVswvDpiZCsMD59H5K3WQA=

    # DEV_AWS_KEY
    - secure: sETz8w0h7y8QwDwyy+LFjdFfP42jYF6ES42D5scs9FcHD/Czb/7kLAEK1lV+K+f9yoZINziAUuDmKAmGGYG/5X0vUEJyhOTbEi2Kv6xavZ7wUneNhb53wH0H0JJi2iVlimzYFBKvwWgFwY1ltQ5YKTRyubBeZQU94XLaWUQYNhXSou9u0vnK40X2D6epbnvRkDhe7GBsd6EBFLWFFKB6GGKqApxrcfMekthVuUcYJoyPN2NbhUQarKQAPhvsvoIdR8h1a6C6KDqV23yqMFT7+EFS8Q6lIhioevAz/w7m45577nJnajtdHDlvMnM+saNiNwwIjoif3hJ6d1Omf36NfCTL1TzcLI8sNkegok0UO++2eOvGNbwFbc2xrO1+180DUf33uyKU3DDO4avaVaiocSusxfLcqY2v56puAykcTtZU218ZcAF6ZmqRlQLonjCTHOS77Fkn5lurZ0XYor2rvN3GeVXRp9eEi7tDOfrg7oz5GdQC1Ea9BXAw49wisEbYbw/vvxyXrHdC5wshERDpuI89Nkug1/Z9Irsf/TMBCbGWjuZsGeLzQfzQAbWB6rRIuCe7BaWR4nYzneJZAXlRJoR3IHFya/dgIIEHoCDiuHgZuTELgdKjbpm0hOjPEs2Z1ZK9z331EdBbVAvhwC76pUx3wu0TW89zZzcApT2DXC0=
    # DEV_AWS_SECRET
    - secure: thX9gw6KXfL1O+FTfgiXScRt54cJzTEmpCWn7FXzpZT8uoPrrWLN4c6XioOZ1JVFD0VYsdua8Nvj7Byj8/etxP8VTyxSAuGTtZW3MCMzdVlxQMD+s2a1UxgFz1rRRHJjJQkddpvrPmKYL62w3bzqyYAaXFsLZMPoZVK93rdOzryGjliLMo+9uPmqiY7svQzav6H1Oof9FuMi64la/PfzPdnyxqkukaXGzv9JEMakbj2Dc4n3hDSsT6ErtzO/Uttv3mZEmQLZua4Gz3dGzhrqUqAZGitsjEHIcKUdeUG6Km9TqJI21eLI0o6meFSv1HXb+w4Ag0o/xqC6Ua1cL4F5CfOUtlyMAgEYUovCaaoHLijqLXzQIgqZ98Aw7edbPjKiZyQoF1S72IaNFO2vYqLS/TovYVViPGSCP6pMbSTifHhptyc46IJBvBFIJrSJI9yZ8LHXKHSjcrzM3CQgtGN2TQRMnvGI1+qR5dpQp31vKdeUF+TZz84QZbh5HVmR9iHNQvAO8O/I9bW73ZaTJ0VNwINRmEUGl5ZLExLpVg54ixZKrlInxJFB7RVKj2Fme9rKWRv/5maPZZBxCvw4ZW3RUI9vf/SlPvgO8JiW1EcCP099iAJuNc6xOr2zdnfofHdcKO5hiOC0KmU1YBa4Xx0vXsKtx3jupPc138+fvjC3bpk=
    # DEV_AWS_LAMBDA_ROLE_ARN
    - secure: LgY6lPEMsR1yyaRiF0VB3+v4J7ngyczwXWlPNQtLS5l1U7ed+jgjQq8O2gSTHGYl6boFF4h6hJs7uQNL1494D75qCy2HsUu6+wXnYsvWbrbHXMyRS+q0asrB5ZASy0JyMPElhWoplfKHLsHdtnnOlW7672VwJfl0VDEwaBsIetakTlDsBxK5sinr9whaO24J6l154I6a63/Dw6y5ZZtZlRWyKQPVMV2rjr9mpv4XVdaxOhExqaf9+3IDrcAnoIfw9Rl0tGHbZ2FTBzps7qpvqQeUOAX+oEeS1qOJRJM5uF7q7C+t/C0aXiNMsz+oXPaqZfsyAwNVBQK5jvkLD4n8LnOl4ErO3w/f8oH7CPpvVt1mg4q9lQNAEv3idr4BscLJEZM6E1NUO/PKfQGDoITRRYWnLUbVpbFZBE2/gX9qJCpt8HWZCnshw4+ePSBn1b18PCBoPnayPuSXpWqYGniDKg9hGgGFf8biOyWF8eZzdRmxJ3pXV7bM06cuqxPkdebkO0zYhiunztS6Brc+lAD0X6upj7GbzOiVgoX+YnAt1UwiirGFdZ0rJHAfFy6605k+27SG/qEBYT6ksox1Er+V2NfnNdGI737zREFHoOUR8qrEnwjWporA0iXyWFMNO5+AevWgaWilO6Cia5WXYm147+HutCWgpfzYG6mEp254/4M=


    # QA_AWS_KEY
    - secure: IupB28kWwn/DDqDucLrpY6xW8RZrJF94LSCOSn3/OrFl1yGPwQHXL5X1ZKhKaaKkblgCiT6K08NpjVAkNwh/bQ9CVzJhjDRFLRnXPrb3M/96qBbyrcuLpOgVREwOEMcg3vRjQlIIH5Ol9U3JhDe4qAVMWfZAh3RhkmesKiTUWiUnr1EWV5n6Eml6K0eR4BTiO6VJD3JeyyeyItq3b0iaB38Eej13mGakQIl/g7WhwCodX08wn+y+X7uJt4MdFa97uaWkPnK/OJ+Nmhkv2KCeZ7xzUhL4L59+sdKeEQChmXKAV7BWrOIC0BV1a0aN2/wK/jyXaF10a2pHesf2siCh6J2DTvIwCXgxFbyI/hVux7h8xYmyXq3lAJBvK7xeEI1c6cBR2icK03UGkYqg5oCY0U00EPfLprUekUA7bh+FjyenzNp2WKZfTzCQxPafz/Qc5UeDoAa/lmMp040bqW/HeuwHmngqrfpEptqtUnSxadn9JkKC05K/e9VTgThGXgNud2FGVgpSLQ0QJKoHiimns5BML6LukYIjLSBKd4rKkTlqGp7+d3ortXIxE+kc1SxriWDvq/BwbcDaGarROVgVkT0XNrHMZ59RUiAkOqiaeXpfF9VKki1Vw/tTaNDrpORCFd2alhq8l2tBtad29pgzMmzZSX8GyQChDSWehWqTeYg=

    # QA_AWS_SECRET
    - secure: angnS6BGmDFQFifua9YkKMFtct1Oy/X7lDI6YpbraRlgH6f5EKL5mLdSBAb0PxHthUJOy8bpynr4CMmcHExGCYyM5MhNrEC2o/I8ZrwLsGPKqNe5CfJipPdJ7MYjwDUC2/9E3GF8NMwJ0XNP9kXRirS0ijguNm5H87YLoou0UlQv0RxuNtMpG4kfJIsTPUHuhhJGyY8DP5yKVkkhkbnWcZfsRR+sxAjmsHqPyjbRPVGw1aVCJu6cG6CmOO4cIvJWSLHBnQvs/oufq+hsAWHGDJlCwKvwJ9R4s+T+RWPumN8NRKpdur4MVxU3K0HgiAGaQrlFxz6JunedDnUKlzDHo439M915rJN3z5Ic24AflTOyDgQ5imQ4UoRqOeL3kPPJnm3D9IAp/3V0HEcm9Z5+rof/mm6kJWQbBH1AmfdU5P4PmklJUKo2LMa7sQIMRlk4ZuJbtROf4Wgx+2bf6H2kF+6tj5b8tbtYHjSpO51FCSdBXO4cTOhYN3FQKcXhNeeFtbiM7ZR8MAUuqfLizXZLWj9SLU7bH7j0lyPpoAU5xx4gPEVGQxUkur0SJDJNBKRYxKUXKVTq8C6tmL5EmQDvl+xOkJsgYSCe94dvbyACdv9W8hNW6GmMsa3jjxW9h35av1GMSKVqLeGXyOJr5InWbCBIRkxkY+ugwwFT01zKLRc=
    
    # QA_AWS_LAMBDA_ROLE_ARN
    - secure: iMgpza58phHyUmOkqSGeVVZBSSrPayC5/sJDzWkHDP0taU+ax+BVRiB9r69IC7iGidc8VKQAWIuY136k/zIN3o2yA84ppeusjZSP2YipUc8Aqw8MMLG2TH0m/Lya6NV4uQ9qqL8YzK9MaGww8kxRNc6q3YgQWIsOcLg+oJqxJ7nH39q37eZcLLc279dhVaWxJCG1SFq6CL4mz0WJoauIBdHaCBSm+8UaOBsG0LKthjbi22FSjp0rlCRdBDtrTpmId83hcKJDs3vHknXY7bapj9LLJ/Oxrg0LKfIJ0cO0k7NteMPmmvDSLZ1/R7z4OlZ/MCG/3x0mupnsA6o7cLnlmtFzLNSO3OZr/O6NQxBQ/XuxJqA2TnkmcRBeVG4PG0DDGkN0JgKrY7QZwRM1T0OiRz1plLRi/YoONLvuje0NGfVSBUCuOfLWJtlC/PTLL1xkbTPEnnHNF6xO9VSj2XZOmStqy9+b/2XV1zJfDciuhY3QF9rqMjKR/CLrlcmyMmpHFzhq0W87O/z81qiH1uSz4kCu9gwBsmUU1TZagiJ4QVZwJ2s67JM3zH2gIHnmcI5HMTfjRC6KJnWIbaq2s28IO6eMZtCPiVqSK+F53f6RE5DJkA3oQYR2Us0t3mGByKmRfbIvIF5+ahca0wBsDBCCB9G0+9zbYAiGOXQkCM74GLs=

    # QA_MEMBER_ES_HOST
    - secure: OPXEwsjMzV3Da4AEvPzat62KuQM/Q7qevkF43K8tB3V9os1Juyo/ydJ0DivvuYDV/lHPkTEXdFlQ3erifCQW+f9rPRobu/g/21aeli4cXqm71rrKxY3DnZYi/igGXanaOWB+vcSGLQRW0n1QeYAFDuq8ByWnmbE+otTtpFlAcxqiF0UesxaOgPiGUt4QCMrmUe4RAokFAvNKmKIrAm9jkCDih/14fP+A/i1V4AstblF2cnnX9DNHPbACnD5MQw21KCV7t1OSusOPaGHK+39ZUWb9L3NYhXzSx7fgxJHHW4h/9uIzdr6tjGI07xPTfzxxV8S/VkMM2icl9R6oFKt/mQpcL7ckQ9UzCjL89snMQ80C503yWpM8BEA4YDqiqaT4YTNv257hLGUZKo0LcznfGVVOMUg2dAn8w6n4VpfmP3+UK1+vgXmEa41nFZ2BO39a+EOTM07NkQQEc0PZJnY8OLdqRf5iE4bxVr4P8VFISS4pSCjEM+VUcZfnxXI8KSvMic5nPAKrgW9CXpp1bb9K6Uf/4ompNzizhOVzlb5hal+4Zp3FJc9Co540exFC8KTTK2HjzjRYD6JCiwI+cVhCNLVYOXzMjK1EfKuayMmkZSgTGofabjpjHRAo9WC8U+oF7awNULi0SongxbF2KCA8BYqIWd8rR3aZqNzRY6aJtnw=

    # PROD_AWS_KEY
    - secure: zunF7zbg+sSUTvWnjThZQX+8Ms4xhWXU2N8WV+XJ0/XBsN16l8pdP2w8jIdk9EAFUO5GIVCLKHifaC3lEeAoZLrxCb9+sGAHrU8hq/+UwFZQ1UmMEgCt7q0HfD5t1wrMxGxwrErl0YARJQHjuISd5qPBUm8rohNMohZUqFP5dTLPnG5DNb0lQS+CSFY2l/xYhFEbM9Fik873YpaU5TDKxKXIj7LKj4UelDqNT7zkPGiAKhlMVx727wiNmUU0Ai5J5McKIJ1BnxIXCC/SoB9+c4H1Rhp3fvZFpBbTnm3G7nVw1eu17tSRZyAFYi3MJlHbA9/nJ7ZzC/KGO0QBiKbI7tbMbyGB+9G+Gjii8ZO7cG3VXkjwrXtklO5ygDrX3Tz8wwG98ht0OLFIa3qqwwVvuQ9B4OxWxDbKv2AVsNJ3SpM79xJN2VQJMVfBKZgXGsosFHclCbB0wea5oairpjI6U1KCWCpcGxmpFmBkQ9SuvXXz86EYkhw8wL3BHMMNWjgzllIgK2lNCRRFpZmvnkzF3zLuSMaWQXYr119VKMh1CJKIOrUNpRL7irMh8zssodGRBCzrjc5SiUd37i0oiST+qIxIGzcrGHF8N/mOjzUUsWQNbFCFpGrWCbAScmqcCuzC9kfmFJAhk6eGoAZEziBaflYpC+272Bu1F5rKs6FTrMM=

    # PROD_AWS_SECRET
    - secure: WGWZs4nh66vcoN0D+zoe0am8JExGEmUAL/JsOVkQPbvjspOQebQaLDxmF5GWxDVqP9Tsz7C3HeCarRec9Rr1KD+hWLK07Xt4XG/lO43zkQewYg6Vm08Wl8LSe0b2txdndxwLDVg4tUVhSXNUMqtBiGlhmIG6y4RZp1xkPtgM+0FFE9yNkmDqOo+/HTHm0L+28fxIEtr56+lK414xD5Sj+yto3d0E0E9jJ0/B+T4yfmeSaUpgs4+AbSphsCwiIIl7OLPcFxp/sLl5lo+ry/kvV6oaEMHkfPSNmXVt6dFgpdl7WICAixGWxZzLnbrJed4eVMSRKUP1X0gvbXKelaUuZjjXEriP1ysHYXNChOu3z81jeKolzk/Ds5RPVWDfUYgH6PFnv1V9OVY3qQkfAT6amA8OxrxMHDdoJLGH8LvDZzZ6RJYByEPE48m4eEZEQ/a8TmECIw/9ZiquyngB14eTGLorTCmCsGjplNx7WTi5TY6kIYby1lm+02Ce7ZyGmYZQeI1MR24/Sao2AxReBUasOmP1dtQHM3LvM2SC6Hu//57j4EjQQtMOKTcRfEuV7ewacH6BP9+ay0Si4Eh9I+FxmeMVVgF+bMpYSzZdyZNR8rJoNZaCZaIzP9bnF5DLOsNFIxpc7/g15IDRbxUW4FNTZnkhyNX0VbgxqDcXVDwgFXE=

    # PROD_AWS_LAMBDA_ROLE_ARN
    - secure: SbyuUZEwTKBh9oqMomn83P4f1ndFOEX5UEieYxMNaHUeoRSBZACqLd/kYncSaWsyMDwhgHh6aIgSpDVvmLvY65FZzM48Bp4YnPHkM+7WeLtQlwXZgqfYkdafVXcW3algjyuQHBRIaAU6n9QRumHB2+D/fRdbqblnDFJc5T9dFuXTvjQ8uHm75ClF8kRgDwSsIz+PgkoUPLUG2WR+c75MlZQBvk7HA6g1+lbEnYTLizU4dxiFzGPE8vKHAKgBsPqgJ/RPa0FevG3NGSBRErY4hBXNZC45fzDCVKBv7flxqutu1KhVkgjpIKx7zrvELxD5fGM3tPMVWhzFpffMzL9P/CZNAfVApMJRhdhOZRAeeoNiCn3ps/De74C+aRxYmnzj2fDCDoMgqGyW1hOXy8CoeeJFGOUVfuWRiwC8ZngN4OPwYDGhmlgYTR09zMpKKT2pj66LmsNRA1g4MA0a+DKq8iUzRJlFs7g4MsjGi/h/fs4G71qIqcf4aiVQ9i8Bh37OmaDXXBX3ic7ND7LCtl73pu9B/vSGpuScD6pLrPmhLel/UHGo35zZ/l7MOiC50zgr++yBRjs+eBhEDIZ+B4zEdrHwEpDBKne41Q0bUeCBqkWs7QoLWm/WVChDoICoGs/8mOOon6W8+WcG5UYAtvwfSukcM3nk2TVuNRnvWaUdccU=

    # PROD_MEMBER_ES_HOST
    - secure: Q4EDWs3CCrxB+W8h+CjH/eGFgAQ1mxH3vQqFYglOoHbSJ7YmhEAGhJ96yVtvp5qiNdKYGbMQFZkUQsFLKInLEyJaagutzYjR+CXaC4yFPEtFtGqSIzUPuevHwYJxGBGMJE5bwNWpVbJy13gw3i0+CVaGnXcVW1P1O96XbDnyi/KdJR51ZkC0kncktlBXl3XtNx95nRbqiRe5ENBlKkDis+Xy6FE/51wG2vWAe73ltLUWaP2J5pnG8HIGzPCR7Nvfkyaj4Z9AjCXua5h9qDWixrois1TAq2npa+MdfObwyrDFWLadG2jerdOeyNTsqDBQimsPmgE8+vL4/rq35cCiKCSCKTHIKfaxmZLU9vVUpywQ6d9Kl1WRN0iDBHqR01eykr1aegy7yp+pxVo8C9FbrGa3s8ZkMEMDi+QXiihdwl5ZkhwFi4uKHUpz/MIIQNoX+A0SzcaNWc6gSbR316NBvUYJAaRtxmohmQ0VChdE1qgydWM7VBLx54104K2ODbvkVejUjisFVKde/0nX3q4ljAAwccqpKZ77mQ5QmwIlZgEGrXbzAI5YkD0MOr3iCvhKwRtRWqiYqzBMSy8Bac0+/j/jaC13z76r6cbprkuz4HIQpGX1vwMsAoS6LcR2W5P9bpXWOeb8guLQuUCFCdIf562sbM4mz41nWs/rzoG696c=